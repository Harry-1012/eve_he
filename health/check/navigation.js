const healthNavData={"🔬 专项检测":[{name:"血常规",url:"blood/routine.html",icon:"🩸"},{name:"生化检查",url:"blood/biochemistry.html",icon:"⚗️"},{name:"甲功三项",url:"thyroid/t3t4tsh.html",icon:"🏥"},{name:"甲状腺抗体",url:"thyroid/antibody.html",icon:"🔬"},{name:"食物过敏",url:"allergy/food.html",icon:"🍎"},{name:"环境过敏",url:"allergy/environment.html",icon:"🌿"}],"🩺 体检报告":[{name:"全面体检",url:"check/physical.html",icon:"📋"},{name:"心电图",url:"check/ecg.html",icon:"❤️"},{name:"血压监测",url:"check/blood-pressure.html",icon:"📊"}],"💡 医嘱建议":[{name:"生活建议",url:"#",icon:"📝",onclick:"scrollToMedicalAdvice('lifestyle')"},{name:"饮食指导",url:"#",icon:"🍎",onclick:"scrollToMedicalAdvice('diet')"},{name:"用药建议",url:"#",icon:"💊",onclick:"scrollToMedicalAdvice('medication')"},{name:"运动方案",url:"#",icon:"🏃",onclick:"scrollToMedicalAdvice('exercise')"}]};document.addEventListener('DOMContentLoaded',function(){setTimeout(()=>{initNavigation();},1000);document.addEventListener('click',function(e){if(!e.target.closest('.dropdown')){closeAllDropdowns();}});});function initNavigation(){const navContainer=document.getElementById('healthNav');const desktopNav=document.getElementById('desktopNav');const sidebarContent=document.getElementById('sidebarContent');if(!navContainer||!desktopNav||!sidebarContent)return;if(typeof testsData==='undefined'||typeof configData==='undefined'){renderDefaultNavigation(desktopNav,sidebarContent);return;}
renderDataBasedNavigation(desktopNav,sidebarContent);}
function renderDataBasedNavigation(desktopNav,sidebarContent){let navHTML='';const categories={"🔬 专项检测":[],"🩺 体检报告":[]};Object.keys(testsData).forEach(testType=>{const testData=testsData[testType];const testConfig=configData.availableTests[testType];if(testData&&testConfig){const item={name:testConfig.name||testType,url:`#test-${testType}`,icon:testConfig.icon||"📋",onclick:`smoothScrollToWithOffset('test-${testType}')`,testType:testType};if(testType.includes('checkup')){categories["🩺 体检报告"].push(item);}else{categories["🔬 专项检测"].push(item);}}});categories["🩺 体检报告"].sort((a,b)=>{const getYear=(testType)=>{const yearMatch=testType.match(/(\d{4})/);return yearMatch?parseInt(yearMatch[1]):0;};const yearA=getYear(a.testType);const yearB=getYear(b.testType);return yearB-yearA;});const specializedGroups={};categories["🔬 专项检测"].forEach(item=>{const baseType=item.testType.replace(/_\d{4}$/,'');if(!specializedGroups[baseType]){specializedGroups[baseType]=[];}
specializedGroups[baseType].push(item);});Object.keys(specializedGroups).forEach(baseType=>{specializedGroups[baseType].sort((a,b)=>{const getYear=(testType)=>{const yearMatch=testType.match(/(\d{4})/);return yearMatch?parseInt(yearMatch[1]):0;};const yearA=getYear(a.testType);const yearB=getYear(b.testType);return yearB-yearA;});});categories["🔬 专项检测"]=[];Object.keys(specializedGroups).forEach(baseType=>{categories["🔬 专项检测"].push(...specializedGroups[baseType]);});categories["🩺 体检报告"].forEach((item,index)=>{if(index>0){const baseType=item.testType.replace(/_\d{4}$/,'');item.onclick=`navigateToHistoryItem('${baseType}','${item.testType}')`;}});const specializedGroupsForClick={};categories["🔬 专项检测"].forEach(item=>{const baseType=item.testType.replace(/_\d{4}$/,'');if(!specializedGroupsForClick[baseType]){specializedGroupsForClick[baseType]=[];}
specializedGroupsForClick[baseType].push(item);});Object.keys(specializedGroupsForClick).forEach(baseType=>{const group=specializedGroupsForClick[baseType];group.forEach((item,index)=>{if(index>0){item.onclick=`navigateToHistoryItem('${baseType}','${item.testType}')`;}});});Object.keys(categories).forEach(category=>{const items=categories[category];if(items.length===0)return;const categoryIcon=category.split(' ')[0];const categoryName=category.split(' ').slice(1).join(' ');navHTML+=`<div class="dropdown"><button class="dropdown-btn"onclick="toggleDropdown(this)"><span class="icon">${categoryIcon}</span><span>${categoryName}</span><span class="dropdown-arrow">▼</span></button><div class="dropdown-content">${items.map(item=>`<a href="#"class="dropdown-item"onclick="${item.onclick ? item.onclick + '; return false;' : 'return false;'}"><span class="icon">${item.icon}</span><span>${item.name}</span></a>`).join('')}</div></div>`;});navHTML+=`<div class="dropdown"><button class="dropdown-btn"onclick="toggleDropdown(this)"><span class="icon">💡</span><span>医嘱建议</span><span class="dropdown-arrow">▼</span></button><div class="dropdown-content"><a href="#"class="dropdown-item"onclick="scrollToMedicalAdvice('lifestyle'); return false;"><span class="icon">📝</span><span>生活建议</span></a><a href="#"class="dropdown-item"onclick="scrollToMedicalAdvice('diet'); return false;"><span class="icon">🍎</span><span>饮食指导</span></a><a href="#"class="dropdown-item"onclick="scrollToMedicalAdvice('medication'); return false;"><span class="icon">💊</span><span>用药建议</span></a><a href="#"class="dropdown-item"onclick="scrollToMedicalAdvice('exercise'); return false;"><span class="icon">🏃</span><span>运动方案</span></a></div></div>`;navHTML+=`<div class="nav-spacer"></div><a href="../index.html"class="nav-back">返回首页</a><div class="search-btn"onclick="toggleSearch()">🔍</div>`;desktopNav.innerHTML=navHTML;generateMobileSidebar(sidebarContent,categories);}
function generateMobileSidebar(sidebarContent,categories){let sidebarHTML='';Object.keys(categories).forEach(category=>{const items=categories[category];if(items.length===0)return;const categoryIcon=category.split(' ')[0];const categoryName=category.split(' ').slice(1).join(' ');const sectionId=`section-${categoryName.replace(/\s+/g,'-')}`;sidebarHTML+=`<div class="sidebar-section"id="${sectionId}"><div class="sidebar-section-title"onclick="toggleSidebarSection('${sectionId}')"><span>${categoryIcon}${categoryName}</span><div style="display: flex; align-items: center; gap: 8px;"><span class="sidebar-section-count">${items.length}</span><span class="sidebar-section-arrow">▼</span></div></div><div class="sidebar-section-content">${items.map(item=>`<a href="#"class="sidebar-item"onclick="${item.onclick || ''}; closeMobileSidebar(); return false;"><span class="icon">${item.icon}</span><span>${item.name}</span></a>`).join('')}</div></div>`;});const adviceItems=[{icon:"📝",name:"生活建议",onclick:"scrollToMedicalAdvice('lifestyle')"},{icon:"🍎",name:"饮食指导",onclick:"scrollToMedicalAdvice('diet')"},{icon:"💊",name:"用药建议",onclick:"scrollToMedicalAdvice('medication')"},{icon:"🏃",name:"运动方案",onclick:"scrollToMedicalAdvice('exercise')"}];sidebarHTML+=`<div class="sidebar-section"id="section-advice"><div class="sidebar-section-title"onclick="toggleSidebarSection('section-advice')"><span>💡 医嘱建议</span><div style="display: flex; align-items: center; gap: 8px;"><span class="sidebar-section-count">${adviceItems.length}</span><span class="sidebar-section-arrow">▼</span></div></div><div class="sidebar-section-content">${adviceItems.map(item=>`<a href="#"class="sidebar-item"onclick="${item.onclick ? item.onclick + '; closeMobileSidebar(); return false;' : 'closeMobileSidebar(); return false;'}"><span class="icon">${item.icon}</span><span>${item.name}</span></a>`).join('')}</div></div><div class="sidebar-section"id="section-navigation"><div class="sidebar-section-title"onclick="toggleSidebarSection('section-navigation')"><span>🧭 页面导航</span><div style="display: flex; align-items: center; gap: 8px;"><span class="sidebar-section-count">2</span><span class="sidebar-section-arrow">▼</span></div></div><div class="sidebar-section-content"><a href="../index.html"class="sidebar-item"><span class="icon">🏠</span><span>返回首页</span></a><a href="#"class="sidebar-item"onclick="window.scrollTo({top: 0, behavior: 'smooth'}); closeMobileSidebar();"><span class="icon">⬆️</span><span>回到顶部</span></a></div></div>`;sidebarContent.innerHTML=sidebarHTML;}
function renderDefaultNavigation(desktopNav,sidebarContent){let navHTML='';Object.keys(healthNavData).forEach(category=>{const items=healthNavData[category];const categoryIcon=category.split(' ')[0];const categoryName=category.split(' ').slice(1).join(' ');navHTML+=`<div class="dropdown"><button class="dropdown-btn"onclick="toggleDropdown(this)"><span class="icon">${categoryIcon}</span><span>${categoryName}</span><span class="dropdown-arrow">▼</span></button><div class="dropdown-content">${items.length>0?items.map(item=>`<a href="${item.url}"class="dropdown-item"${item.onclick?`onclick="${item.onclick}"`:''}><span class="icon">${item.icon}</span><span>${item.name}</span></a>`).join(''):'<div class="dropdown-placeholder">暂无数据</div>'}</div></div>`;});navHTML+=`<div class="nav-spacer"></div><a href="../index.html"class="nav-back">返回首页</a><div class="search-btn"onclick="toggleSearch()">🔍</div>`;desktopNav.innerHTML=navHTML;generateDefaultMobileSidebar(sidebarContent);}
function generateDefaultMobileSidebar(sidebarContent){let sidebarHTML='';Object.keys(healthNavData).forEach(category=>{const items=healthNavData[category];const categoryIcon=category.split(' ')[0];const categoryName=category.split(' ').slice(1).join(' ');const sectionId=`section-${categoryName.replace(/\s+/g,'-')}`;sidebarHTML+=`<div class="sidebar-section"id="${sectionId}"><div class="sidebar-section-title"onclick="toggleSidebarSection('${sectionId}')"><span>${categoryIcon}${categoryName}</span><div style="display: flex; align-items: center; gap: 8px;"><span class="sidebar-section-count">${items.length}</span><span class="sidebar-section-arrow">▼</span></div></div><div class="sidebar-section-content">${items.length>0?items.map(item=>`<a href="${item.url}"class="sidebar-item"${item.onclick?`onclick="${item.onclick}; closeMobileSidebar();"`:'onclick="closeMobileSidebar();"'}><span class="icon">${item.icon}</span><span>${item.name}</span></a>`).join(''):'<div class="sidebar-placeholder">暂无数据</div>'}</div></div>`;});sidebarHTML+=`<div class="sidebar-section"id="section-navigation"><div class="sidebar-section-title"onclick="toggleSidebarSection('section-navigation')"><span>🧭 页面导航</span><div style="display: flex; align-items: center; gap: 8px;"><span class="sidebar-section-count">2</span><span class="sidebar-section-arrow">▼</span></div></div><div class="sidebar-section-content"><a href="../index.html"class="sidebar-item"><span class="icon">🏠</span><span>返回首页</span></a><a href="#"class="sidebar-item"onclick="window.scrollTo({top: 0, behavior: 'smooth'}); closeMobileSidebar();"><span class="icon">⬆️</span><span>回到顶部</span></a></div></div>`;sidebarContent.innerHTML=sidebarHTML;}
function toggleDropdown(button){const dropdown=button.closest('.dropdown');const isOpen=dropdown.classList.contains('show');closeAllDropdowns();if(!isOpen){dropdown.classList.add('show');}}
function closeAllDropdowns(){document.querySelectorAll('.dropdown.show').forEach(dropdown=>{dropdown.classList.remove('show');});}
function toggleSearch(){const searchTerm=prompt('请输入搜索关键词：');if(searchTerm){alert(`搜索功能开发中...\n您搜索的是：${searchTerm}`);}}
function refreshNavigation(){initNavigation();}
function navigateToHistoryItem(baseType,targetTestType){smoothScrollToWithOffset(`test-${baseType}`);setTimeout(()=>{const targetElement=document.getElementById(`history-item-${targetTestType}`);if(targetElement){const year=targetElement.getAttribute('data-year');const yearContent=document.getElementById(`history-${baseType}-${year}`);const yearToggle=document.querySelector(`[onclick="toggleYearHistory('${baseType}', '${year}')"]`);if(yearContent&&yearToggle){if(yearContent.style.display==='none'||!yearContent.style.display){toggleYearHistory(baseType,year);}
setTimeout(()=>{const elementRect=targetElement.getBoundingClientRect();const elementTop=elementRect.top+window.pageYOffset;const viewportHeight=window.innerHeight;const offset=viewportHeight*0.25;const targetPosition=elementTop-offset;window.scrollTo({top:Math.max(0,targetPosition),behavior:'smooth'});targetElement.style.backgroundColor='rgba(255, 235, 59, 0.3)';setTimeout(()=>{targetElement.style.backgroundColor='';},2000);},300);}}},500);}
function toggleMobileSidebar(){const sidebar=document.getElementById('mobileSidebar');const overlay=document.getElementById('sidebarOverlay');if(sidebar&&overlay){sidebar.classList.add('open');overlay.classList.add('show');document.body.style.overflow='hidden';setTimeout(()=>{restoreSidebarCollapsedState();autoExpandRelevantSections();},100);}}
function autoExpandRelevantSections(){const hasTestContent=document.querySelector('#test-thyroid, #test-blood, #test-allergy');const hasRecommendations=document.querySelector('#recommendations');if(hasTestContent){const specializedSection=document.getElementById('section-专项检测');if(specializedSection&&specializedSection.classList.contains('collapsed')){specializedSection.classList.remove('collapsed');}}
if(hasRecommendations){const adviceSection=document.getElementById('section-advice');if(adviceSection&&adviceSection.classList.contains('collapsed')){adviceSection.classList.remove('collapsed');}}}
function closeMobileSidebar(){const sidebar=document.getElementById('mobileSidebar');const overlay=document.getElementById('sidebarOverlay');if(sidebar&&overlay){sidebar.classList.remove('open');overlay.classList.remove('show');document.body.style.overflow='';}}
function toggleSidebarSection(sectionId){const section=document.getElementById(sectionId);if(section){section.classList.toggle('collapsed');const collapsedSections=JSON.parse(localStorage.getItem('sidebarCollapsedSections')||'[]');const index=collapsedSections.indexOf(sectionId);if(section.classList.contains('collapsed')){if(index===-1)collapsedSections.push(sectionId);}else{if(index>-1)collapsedSections.splice(index,1);}
localStorage.setItem('sidebarCollapsedSections',JSON.stringify(collapsedSections));}}
function restoreSidebarCollapsedState(){const collapsedSections=JSON.parse(localStorage.getItem('sidebarCollapsedSections')||'[]');collapsedSections.forEach(sectionId=>{const section=document.getElementById(sectionId);if(section){section.classList.add('collapsed');}});}
document.addEventListener('DOMContentLoaded',function(){const sidebar=document.getElementById('mobileSidebar');if(sidebar){sidebar.addEventListener('touchmove',function(e){e.stopPropagation();});document.addEventListener('keydown',function(e){if(e.key==='Escape'){closeMobileSidebar();}});setTimeout(()=>{restoreSidebarCollapsedState();},100);}});window.scrollToFirstTest=function(){const firstTestCard=document.querySelector('.eve-card[id^="test-"]');if(firstTestCard){const cardId=firstTestCard.getAttribute('id');if(cardId){smoothScrollToWithOffset(cardId);}else{if(typeof optimizedScrollToElement==='function'){optimizedScrollToElement(firstTestCard);}else{firstTestCard.scrollIntoView({behavior:'smooth',block:'start'});}}}else{if(typeof smoothScrollTo==='function'){smoothScrollTo('recommendations');}}}
window.smoothScrollToWithOffset=function(elementId){const element=document.getElementById(elementId);if(element){const navHeight=document.querySelector('.health-nav')?.offsetHeight||80;const elementRect=element.getBoundingClientRect();const elementTop=elementRect.top+window.pageYOffset;const viewportHeight=window.innerHeight;const targetOffset=viewportHeight*0.13;const targetPosition=elementTop-targetOffset;window.scrollTo({top:Math.max(0,targetPosition),behavior:'smooth'});}}
window.scrollToMedicalAdvice=function(adviceType){showIndependentMedicalAdvice(adviceType);}
window.showIndependentMedicalAdvice=function(adviceType){if(!window.medicalAdvice||!window.medicalAdvice.advice){alert('医疗建议数据加载失败，请刷新页面重试');return;}
const adviceCard=document.getElementById('medicalAdviceCard');const adviceTitle=document.getElementById('adviceTitle');const adviceContent=document.getElementById('adviceContent');if(!adviceCard||!adviceTitle||!adviceContent){console.error('医疗建议显示区域未找到');return;}
const section=window.medicalAdvice.advice[adviceType];if(!section){console.error('找不到指定的医疗建议类型:',adviceType);return;}
adviceTitle.innerHTML=`${section.icon}${section.title}`;let content='';if(section.sections&&section.sections.length>0){section.sections.forEach(item=>{content+=`<div class="advice-section"style="margin-bottom: 20px; padding: 15px; background: rgba(${section.color ? hexToRgb(section.color) : '116, 185, 255'}, 0.1); border-left: 4px solid ${section.color || '#74b9ff'}; border-radius: 8px;"><h4 style="color: ${section.color || '#74b9ff'}; margin-bottom: 10px; font-size: 16px;">${item.category}</h4><p style="margin-bottom: 10px; line-height: 1.6;">${item.content}</p>`;if(item.details&&item.details.length>0){content+=`<ul style="margin: 10px 0; padding-left: 20px; line-height: 1.6;">`;item.details.forEach(detail=>{content+=`<li style="margin-bottom: 5px;">${detail}</li>`;});content+=`</ul>`;}
content+=`</div>`;});}
adviceContent.innerHTML=content;adviceCard.style.display='block';setTimeout(()=>{smoothScrollToWithOffset('medicalAdviceCard');},100);}
window.showIndependentMedicalAdviceWithScroll=function(adviceType){showIndependentMedicalAdvice(adviceType);}
window.hideMedicalAdvice=function(){const adviceCard=document.getElementById('medicalAdviceCard');if(adviceCard){adviceCard.style.display='none';}}
function hexToRgb(hex){const result=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);return result?`${parseInt(result[1],16)},${parseInt(result[2],16)},${parseInt(result[3],16)}`:'116, 185, 255';}
function highlightMedicalAdvice(adviceType){document.querySelectorAll('.advice-highlight').forEach(el=>{el.classList.remove('advice-highlight');});let targetElements=[];switch(adviceType){case'lifestyle':targetElements=Array.from(document.querySelectorAll('.eve-note-item')).filter(el=>el.textContent.includes('📝')||el.textContent.includes('生活方式')||el.textContent.includes('作息')||el.textContent.includes('规律'));break;case'diet':targetElements=Array.from(document.querySelectorAll('.eve-note-item')).filter(el=>el.textContent.includes('🍎')||el.textContent.includes('饮食')||el.textContent.includes('营养')||el.textContent.includes('食物'));break;case'medication':targetElements=Array.from(document.querySelectorAll('.eve-note-item')).filter(el=>el.textContent.includes('💊')||el.textContent.includes('用药')||el.textContent.includes('药物')||el.textContent.includes('治疗'));break;case'exercise':targetElements=Array.from(document.querySelectorAll('.eve-note-item')).filter(el=>el.textContent.includes('🏃')||el.textContent.includes('运动')||el.textContent.includes('锻炼')||el.textContent.includes('健身'));break;}
targetElements.forEach(el=>{el.classList.add('advice-highlight');setTimeout(()=>{el.classList.remove('advice-highlight');},3000);});}