const healthNavData={"ğŸ”¬ ä¸“é¡¹æ£€æµ‹":[{name:"è¡€å¸¸è§„",url:"blood/routine.html",icon:"ğŸ©¸"},{name:"ç”ŸåŒ–æ£€æŸ¥",url:"blood/biochemistry.html",icon:"âš—ï¸"},{name:"ç”²åŠŸä¸‰é¡¹",url:"thyroid/t3t4tsh.html",icon:"ğŸ¥"},{name:"ç”²çŠ¶è…ºæŠ—ä½“",url:"thyroid/antibody.html",icon:"ğŸ”¬"},{name:"é£Ÿç‰©è¿‡æ•",url:"allergy/food.html",icon:"ğŸ"},{name:"ç¯å¢ƒè¿‡æ•",url:"allergy/environment.html",icon:"ğŸŒ¿"}],"ğŸ©º ä½“æ£€æŠ¥å‘Š":[{name:"å…¨é¢ä½“æ£€",url:"check/physical.html",icon:"ğŸ“‹"},{name:"å¿ƒç”µå›¾",url:"check/ecg.html",icon:"â¤ï¸"},{name:"è¡€å‹ç›‘æµ‹",url:"check/blood-pressure.html",icon:"ğŸ“Š"}],"ğŸ’¡ åŒ»å˜±å»ºè®®":[{name:"ç”Ÿæ´»å»ºè®®",url:"#",icon:"ğŸ“",onclick:"scrollToMedicalAdvice('lifestyle')"},{name:"é¥®é£ŸæŒ‡å¯¼",url:"#",icon:"ğŸ",onclick:"scrollToMedicalAdvice('diet')"},{name:"ç”¨è¯å»ºè®®",url:"#",icon:"ğŸ’Š",onclick:"scrollToMedicalAdvice('medication')"},{name:"è¿åŠ¨æ–¹æ¡ˆ",url:"#",icon:"ğŸƒ",onclick:"scrollToMedicalAdvice('exercise')"}]};document.addEventListener('DOMContentLoaded',function(){setTimeout(()=>{initNavigation();},1000);document.addEventListener('click',function(e){if(!e.target.closest('.dropdown')){closeAllDropdowns();}});});function initNavigation(){const navContainer=document.getElementById('healthNav');const desktopNav=document.getElementById('desktopNav');const sidebarContent=document.getElementById('sidebarContent');if(!navContainer||!desktopNav||!sidebarContent)return;if(typeof testsData==='undefined'||typeof configData==='undefined'){renderDefaultNavigation(desktopNav,sidebarContent);return;}
renderDataBasedNavigation(desktopNav,sidebarContent);}
function renderDataBasedNavigation(desktopNav,sidebarContent){let navHTML='';const categories={"ğŸ”¬ ä¸“é¡¹æ£€æµ‹":[],"ğŸ©º ä½“æ£€æŠ¥å‘Š":[]};Object.keys(testsData).forEach(testType=>{const testData=testsData[testType];const testConfig=configData.availableTests[testType];if(testData&&testConfig){const item={name:testConfig.name||testType,url:`#test-${testType}`,icon:testConfig.icon||"ğŸ“‹",onclick:`smoothScrollToWithOffset('test-${testType}')`,testType:testType};if(testType.includes('checkup')){categories["ğŸ©º ä½“æ£€æŠ¥å‘Š"].push(item);}else{categories["ğŸ”¬ ä¸“é¡¹æ£€æµ‹"].push(item);}}});categories["ğŸ©º ä½“æ£€æŠ¥å‘Š"].sort((a,b)=>{const getYear=(testType)=>{const yearMatch=testType.match(/(\d{4})/);return yearMatch?parseInt(yearMatch[1]):0;};const yearA=getYear(a.testType);const yearB=getYear(b.testType);return yearB-yearA;});const specializedGroups={};categories["ğŸ”¬ ä¸“é¡¹æ£€æµ‹"].forEach(item=>{const baseType=item.testType.replace(/_\d{4}$/,'');if(!specializedGroups[baseType]){specializedGroups[baseType]=[];}
specializedGroups[baseType].push(item);});Object.keys(specializedGroups).forEach(baseType=>{specializedGroups[baseType].sort((a,b)=>{const getYear=(testType)=>{const yearMatch=testType.match(/(\d{4})/);return yearMatch?parseInt(yearMatch[1]):0;};const yearA=getYear(a.testType);const yearB=getYear(b.testType);return yearB-yearA;});});categories["ğŸ”¬ ä¸“é¡¹æ£€æµ‹"]=[];Object.keys(specializedGroups).forEach(baseType=>{categories["ğŸ”¬ ä¸“é¡¹æ£€æµ‹"].push(...specializedGroups[baseType]);});categories["ğŸ©º ä½“æ£€æŠ¥å‘Š"].forEach((item,index)=>{if(index>0){const baseType=item.testType.replace(/_\d{4}$/,'');item.onclick=`navigateToHistoryItem('${baseType}','${item.testType}')`;}});const specializedGroupsForClick={};categories["ğŸ”¬ ä¸“é¡¹æ£€æµ‹"].forEach(item=>{const baseType=item.testType.replace(/_\d{4}$/,'');if(!specializedGroupsForClick[baseType]){specializedGroupsForClick[baseType]=[];}
specializedGroupsForClick[baseType].push(item);});Object.keys(specializedGroupsForClick).forEach(baseType=>{const group=specializedGroupsForClick[baseType];group.forEach((item,index)=>{if(index>0){item.onclick=`navigateToHistoryItem('${baseType}','${item.testType}')`;}});});Object.keys(categories).forEach(category=>{const items=categories[category];if(items.length===0)return;const categoryIcon=category.split(' ')[0];const categoryName=category.split(' ').slice(1).join(' ');navHTML+=`<div class="dropdown"><button class="dropdown-btn"onclick="toggleDropdown(this)"><span class="icon">${categoryIcon}</span><span>${categoryName}</span><span class="dropdown-arrow">â–¼</span></button><div class="dropdown-content">${items.map(item=>`<a href="#"class="dropdown-item"onclick="${item.onclick ? item.onclick + '; return false;' : 'return false;'}"><span class="icon">${item.icon}</span><span>${item.name}</span></a>`).join('')}</div></div>`;});navHTML+=`<div class="dropdown"><button class="dropdown-btn"onclick="toggleDropdown(this)"><span class="icon">ğŸ’¡</span><span>åŒ»å˜±å»ºè®®</span><span class="dropdown-arrow">â–¼</span></button><div class="dropdown-content"><a href="#"class="dropdown-item"onclick="scrollToMedicalAdvice('lifestyle'); return false;"><span class="icon">ğŸ“</span><span>ç”Ÿæ´»å»ºè®®</span></a><a href="#"class="dropdown-item"onclick="scrollToMedicalAdvice('diet'); return false;"><span class="icon">ğŸ</span><span>é¥®é£ŸæŒ‡å¯¼</span></a><a href="#"class="dropdown-item"onclick="scrollToMedicalAdvice('medication'); return false;"><span class="icon">ğŸ’Š</span><span>ç”¨è¯å»ºè®®</span></a><a href="#"class="dropdown-item"onclick="scrollToMedicalAdvice('exercise'); return false;"><span class="icon">ğŸƒ</span><span>è¿åŠ¨æ–¹æ¡ˆ</span></a></div></div>`;navHTML+=`<div class="nav-spacer"></div><a href="../index.html"class="nav-back">è¿”å›é¦–é¡µ</a><div class="search-btn"onclick="toggleSearch()">ğŸ”</div>`;desktopNav.innerHTML=navHTML;generateMobileSidebar(sidebarContent,categories);}
function generateMobileSidebar(sidebarContent,categories){let sidebarHTML='';Object.keys(categories).forEach(category=>{const items=categories[category];if(items.length===0)return;const categoryIcon=category.split(' ')[0];const categoryName=category.split(' ').slice(1).join(' ');const sectionId=`section-${categoryName.replace(/\s+/g,'-')}`;sidebarHTML+=`<div class="sidebar-section"id="${sectionId}"><div class="sidebar-section-title"onclick="toggleSidebarSection('${sectionId}')"><span>${categoryIcon}${categoryName}</span><div style="display: flex; align-items: center; gap: 8px;"><span class="sidebar-section-count">${items.length}</span><span class="sidebar-section-arrow">â–¼</span></div></div><div class="sidebar-section-content">${items.map(item=>`<a href="#"class="sidebar-item"onclick="${item.onclick || ''}; closeMobileSidebar(); return false;"><span class="icon">${item.icon}</span><span>${item.name}</span></a>`).join('')}</div></div>`;});const adviceItems=[{icon:"ğŸ“",name:"ç”Ÿæ´»å»ºè®®",onclick:"scrollToMedicalAdvice('lifestyle')"},{icon:"ğŸ",name:"é¥®é£ŸæŒ‡å¯¼",onclick:"scrollToMedicalAdvice('diet')"},{icon:"ğŸ’Š",name:"ç”¨è¯å»ºè®®",onclick:"scrollToMedicalAdvice('medication')"},{icon:"ğŸƒ",name:"è¿åŠ¨æ–¹æ¡ˆ",onclick:"scrollToMedicalAdvice('exercise')"}];sidebarHTML+=`<div class="sidebar-section"id="section-advice"><div class="sidebar-section-title"onclick="toggleSidebarSection('section-advice')"><span>ğŸ’¡ åŒ»å˜±å»ºè®®</span><div style="display: flex; align-items: center; gap: 8px;"><span class="sidebar-section-count">${adviceItems.length}</span><span class="sidebar-section-arrow">â–¼</span></div></div><div class="sidebar-section-content">${adviceItems.map(item=>`<a href="#"class="sidebar-item"onclick="${item.onclick ? item.onclick + '; closeMobileSidebar(); return false;' : 'closeMobileSidebar(); return false;'}"><span class="icon">${item.icon}</span><span>${item.name}</span></a>`).join('')}</div></div><div class="sidebar-section"id="section-navigation"><div class="sidebar-section-title"onclick="toggleSidebarSection('section-navigation')"><span>ğŸ§­ é¡µé¢å¯¼èˆª</span><div style="display: flex; align-items: center; gap: 8px;"><span class="sidebar-section-count">2</span><span class="sidebar-section-arrow">â–¼</span></div></div><div class="sidebar-section-content"><a href="../index.html"class="sidebar-item"><span class="icon">ğŸ </span><span>è¿”å›é¦–é¡µ</span></a><a href="#"class="sidebar-item"onclick="window.scrollTo({top: 0, behavior: 'smooth'}); closeMobileSidebar();"><span class="icon">â¬†ï¸</span><span>å›åˆ°é¡¶éƒ¨</span></a></div></div>`;sidebarContent.innerHTML=sidebarHTML;}
function renderDefaultNavigation(desktopNav,sidebarContent){let navHTML='';Object.keys(healthNavData).forEach(category=>{const items=healthNavData[category];const categoryIcon=category.split(' ')[0];const categoryName=category.split(' ').slice(1).join(' ');navHTML+=`<div class="dropdown"><button class="dropdown-btn"onclick="toggleDropdown(this)"><span class="icon">${categoryIcon}</span><span>${categoryName}</span><span class="dropdown-arrow">â–¼</span></button><div class="dropdown-content">${items.length>0?items.map(item=>`<a href="${item.url}"class="dropdown-item"${item.onclick?`onclick="${item.onclick}"`:''}><span class="icon">${item.icon}</span><span>${item.name}</span></a>`).join(''):'<div class="dropdown-placeholder">æš‚æ— æ•°æ®</div>'}</div></div>`;});navHTML+=`<div class="nav-spacer"></div><a href="../index.html"class="nav-back">è¿”å›é¦–é¡µ</a><div class="search-btn"onclick="toggleSearch()">ğŸ”</div>`;desktopNav.innerHTML=navHTML;generateDefaultMobileSidebar(sidebarContent);}
function generateDefaultMobileSidebar(sidebarContent){let sidebarHTML='';Object.keys(healthNavData).forEach(category=>{const items=healthNavData[category];const categoryIcon=category.split(' ')[0];const categoryName=category.split(' ').slice(1).join(' ');const sectionId=`section-${categoryName.replace(/\s+/g,'-')}`;sidebarHTML+=`<div class="sidebar-section"id="${sectionId}"><div class="sidebar-section-title"onclick="toggleSidebarSection('${sectionId}')"><span>${categoryIcon}${categoryName}</span><div style="display: flex; align-items: center; gap: 8px;"><span class="sidebar-section-count">${items.length}</span><span class="sidebar-section-arrow">â–¼</span></div></div><div class="sidebar-section-content">${items.length>0?items.map(item=>`<a href="${item.url}"class="sidebar-item"${item.onclick?`onclick="${item.onclick}; closeMobileSidebar();"`:'onclick="closeMobileSidebar();"'}><span class="icon">${item.icon}</span><span>${item.name}</span></a>`).join(''):'<div class="sidebar-placeholder">æš‚æ— æ•°æ®</div>'}</div></div>`;});sidebarHTML+=`<div class="sidebar-section"id="section-navigation"><div class="sidebar-section-title"onclick="toggleSidebarSection('section-navigation')"><span>ğŸ§­ é¡µé¢å¯¼èˆª</span><div style="display: flex; align-items: center; gap: 8px;"><span class="sidebar-section-count">2</span><span class="sidebar-section-arrow">â–¼</span></div></div><div class="sidebar-section-content"><a href="../index.html"class="sidebar-item"><span class="icon">ğŸ </span><span>è¿”å›é¦–é¡µ</span></a><a href="#"class="sidebar-item"onclick="window.scrollTo({top: 0, behavior: 'smooth'}); closeMobileSidebar();"><span class="icon">â¬†ï¸</span><span>å›åˆ°é¡¶éƒ¨</span></a></div></div>`;sidebarContent.innerHTML=sidebarHTML;}
function toggleDropdown(button){const dropdown=button.closest('.dropdown');const isOpen=dropdown.classList.contains('show');closeAllDropdowns();if(!isOpen){dropdown.classList.add('show');}}
function closeAllDropdowns(){document.querySelectorAll('.dropdown.show').forEach(dropdown=>{dropdown.classList.remove('show');});}
function toggleSearch(){const searchTerm=prompt('è¯·è¾“å…¥æœç´¢å…³é”®è¯ï¼š');if(searchTerm){alert(`æœç´¢åŠŸèƒ½å¼€å‘ä¸­...\næ‚¨æœç´¢çš„æ˜¯ï¼š${searchTerm}`);}}
function refreshNavigation(){initNavigation();}
function navigateToHistoryItem(baseType,targetTestType){smoothScrollToWithOffset(`test-${baseType}`);setTimeout(()=>{const targetElement=document.getElementById(`history-item-${targetTestType}`);if(targetElement){const year=targetElement.getAttribute('data-year');const yearContent=document.getElementById(`history-${baseType}-${year}`);const yearToggle=document.querySelector(`[onclick="toggleYearHistory('${baseType}', '${year}')"]`);if(yearContent&&yearToggle){if(yearContent.style.display==='none'||!yearContent.style.display){toggleYearHistory(baseType,year);}
setTimeout(()=>{const elementRect=targetElement.getBoundingClientRect();const elementTop=elementRect.top+window.pageYOffset;const viewportHeight=window.innerHeight;const offset=viewportHeight*0.25;const targetPosition=elementTop-offset;window.scrollTo({top:Math.max(0,targetPosition),behavior:'smooth'});targetElement.style.backgroundColor='rgba(255, 235, 59, 0.3)';setTimeout(()=>{targetElement.style.backgroundColor='';},2000);},300);}}},500);}
function toggleMobileSidebar(){const sidebar=document.getElementById('mobileSidebar');const overlay=document.getElementById('sidebarOverlay');if(sidebar&&overlay){sidebar.classList.add('open');overlay.classList.add('show');document.body.style.overflow='hidden';setTimeout(()=>{restoreSidebarCollapsedState();autoExpandRelevantSections();},100);}}
function autoExpandRelevantSections(){const hasTestContent=document.querySelector('#test-thyroid, #test-blood, #test-allergy');const hasRecommendations=document.querySelector('#recommendations');if(hasTestContent){const specializedSection=document.getElementById('section-ä¸“é¡¹æ£€æµ‹');if(specializedSection&&specializedSection.classList.contains('collapsed')){specializedSection.classList.remove('collapsed');}}
if(hasRecommendations){const adviceSection=document.getElementById('section-advice');if(adviceSection&&adviceSection.classList.contains('collapsed')){adviceSection.classList.remove('collapsed');}}}
function closeMobileSidebar(){const sidebar=document.getElementById('mobileSidebar');const overlay=document.getElementById('sidebarOverlay');if(sidebar&&overlay){sidebar.classList.remove('open');overlay.classList.remove('show');document.body.style.overflow='';}}
function toggleSidebarSection(sectionId){const section=document.getElementById(sectionId);if(section){section.classList.toggle('collapsed');const collapsedSections=JSON.parse(localStorage.getItem('sidebarCollapsedSections')||'[]');const index=collapsedSections.indexOf(sectionId);if(section.classList.contains('collapsed')){if(index===-1)collapsedSections.push(sectionId);}else{if(index>-1)collapsedSections.splice(index,1);}
localStorage.setItem('sidebarCollapsedSections',JSON.stringify(collapsedSections));}}
function restoreSidebarCollapsedState(){const collapsedSections=JSON.parse(localStorage.getItem('sidebarCollapsedSections')||'[]');collapsedSections.forEach(sectionId=>{const section=document.getElementById(sectionId);if(section){section.classList.add('collapsed');}});}
document.addEventListener('DOMContentLoaded',function(){const sidebar=document.getElementById('mobileSidebar');if(sidebar){sidebar.addEventListener('touchmove',function(e){e.stopPropagation();});document.addEventListener('keydown',function(e){if(e.key==='Escape'){closeMobileSidebar();}});setTimeout(()=>{restoreSidebarCollapsedState();},100);}});window.scrollToFirstTest=function(){const firstTestCard=document.querySelector('.eve-card[id^="test-"]');if(firstTestCard){const cardId=firstTestCard.getAttribute('id');if(cardId){smoothScrollToWithOffset(cardId);}else{if(typeof optimizedScrollToElement==='function'){optimizedScrollToElement(firstTestCard);}else{firstTestCard.scrollIntoView({behavior:'smooth',block:'start'});}}}else{if(typeof smoothScrollTo==='function'){smoothScrollTo('recommendations');}}}
window.smoothScrollToWithOffset=function(elementId){const element=document.getElementById(elementId);if(element){const navHeight=document.querySelector('.health-nav')?.offsetHeight||80;const elementRect=element.getBoundingClientRect();const elementTop=elementRect.top+window.pageYOffset;const viewportHeight=window.innerHeight;const targetOffset=viewportHeight*0.13;const targetPosition=elementTop-targetOffset;window.scrollTo({top:Math.max(0,targetPosition),behavior:'smooth'});}}
window.scrollToMedicalAdvice=function(adviceType){showIndependentMedicalAdvice(adviceType);}
window.showIndependentMedicalAdvice=function(adviceType){if(!window.medicalAdvice||!window.medicalAdvice.advice){alert('åŒ»ç–—å»ºè®®æ•°æ®åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•');return;}
const adviceCard=document.getElementById('medicalAdviceCard');const adviceTitle=document.getElementById('adviceTitle');const adviceContent=document.getElementById('adviceContent');if(!adviceCard||!adviceTitle||!adviceContent){console.error('åŒ»ç–—å»ºè®®æ˜¾ç¤ºåŒºåŸŸæœªæ‰¾åˆ°');return;}
const section=window.medicalAdvice.advice[adviceType];if(!section){console.error('æ‰¾ä¸åˆ°æŒ‡å®šçš„åŒ»ç–—å»ºè®®ç±»å‹:',adviceType);return;}
adviceTitle.innerHTML=`${section.icon}${section.title}`;let content='';if(section.sections&&section.sections.length>0){section.sections.forEach(item=>{content+=`<div class="advice-section"style="margin-bottom: 20px; padding: 15px; background: rgba(${section.color ? hexToRgb(section.color) : '116, 185, 255'}, 0.1); border-left: 4px solid ${section.color || '#74b9ff'}; border-radius: 8px;"><h4 style="color: ${section.color || '#74b9ff'}; margin-bottom: 10px; font-size: 16px;">${item.category}</h4><p style="margin-bottom: 10px; line-height: 1.6;">${item.content}</p>`;if(item.details&&item.details.length>0){content+=`<ul style="margin: 10px 0; padding-left: 20px; line-height: 1.6;">`;item.details.forEach(detail=>{content+=`<li style="margin-bottom: 5px;">${detail}</li>`;});content+=`</ul>`;}
content+=`</div>`;});}
adviceContent.innerHTML=content;adviceCard.style.display='block';setTimeout(()=>{smoothScrollToWithOffset('medicalAdviceCard');},100);}
window.showIndependentMedicalAdviceWithScroll=function(adviceType){showIndependentMedicalAdvice(adviceType);}
window.hideMedicalAdvice=function(){const adviceCard=document.getElementById('medicalAdviceCard');if(adviceCard){adviceCard.style.display='none';}}
function hexToRgb(hex){const result=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);return result?`${parseInt(result[1],16)},${parseInt(result[2],16)},${parseInt(result[3],16)}`:'116, 185, 255';}
function highlightMedicalAdvice(adviceType){document.querySelectorAll('.advice-highlight').forEach(el=>{el.classList.remove('advice-highlight');});let targetElements=[];switch(adviceType){case'lifestyle':targetElements=Array.from(document.querySelectorAll('.eve-note-item')).filter(el=>el.textContent.includes('ğŸ“')||el.textContent.includes('ç”Ÿæ´»æ–¹å¼')||el.textContent.includes('ä½œæ¯')||el.textContent.includes('è§„å¾‹'));break;case'diet':targetElements=Array.from(document.querySelectorAll('.eve-note-item')).filter(el=>el.textContent.includes('ğŸ')||el.textContent.includes('é¥®é£Ÿ')||el.textContent.includes('è¥å…»')||el.textContent.includes('é£Ÿç‰©'));break;case'medication':targetElements=Array.from(document.querySelectorAll('.eve-note-item')).filter(el=>el.textContent.includes('ğŸ’Š')||el.textContent.includes('ç”¨è¯')||el.textContent.includes('è¯ç‰©')||el.textContent.includes('æ²»ç–—'));break;case'exercise':targetElements=Array.from(document.querySelectorAll('.eve-note-item')).filter(el=>el.textContent.includes('ğŸƒ')||el.textContent.includes('è¿åŠ¨')||el.textContent.includes('é”»ç‚¼')||el.textContent.includes('å¥èº«'));break;}
targetElements.forEach(el=>{el.classList.add('advice-highlight');setTimeout(()=>{el.classList.remove('advice-highlight');},3000);});}